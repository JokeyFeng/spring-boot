<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户信息</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- 生产环境版本，优化了尺寸和速度 -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>

<div id="app" class="table">
    <table>
        <tr>
            <td>ID</td>
            <td>姓名</td>
            <td>年龄</td>
            <td>操作</td>
        </tr>
        <tbody>
        <tr v-for="u in user">
            <td>{{u.id}}</td>
            <td>{{u.name}}</td>
            <td>{{u.age}}</td>
            <td><a href="remove">删除</a></td>
        </tr>
        </tbody>
    </table>
    <div>
        姓名:<input v-model="name"><br>
        密码:<input v-model="pass"><br>
        年龄:<input v-model="age"><br>
        手机:<input v-model="mobile"><br>
        <button @click="save">提交</button>
    </div>

    <div>
        姓名:<input v-model="username"><br>
        密码:<input v-model="password"><br>
        <button @click="login">登录</button>
    </div>
</div>

<script type="text/javascript">
    axios.defaults.baseURL = 'http://127.0.0.1:8890';
    axios.defaults.headers.common['Authorization'] = localStorage.getItem("token");
    var app = new Vue({
        el: "#app",
        data: {
            user: [{"id": 1, "name": "yinjihuan", "age": 20}],
            name: "",
            age: 0,
            pass: "",
            mobile: "",
            username: "",
            password: ""
        },
        methods: {
            loadData: function () {
                // 为给定 ID 的 user 创建请求
                var that = this;
                axios.get('/user/list')
                    .then(function (response) {
                        that.user = response.data;
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            },
            save: function () {
                axios.post('/user/save', {
                    name: this.name,
                    pass: this.pass,
                    age: this.age,
                    mobile: this.mobile
                }).then(function (response) {
                    alert(response.data);
                }).catch(function (error) {
                    console.log(error);
                });
            },
            login: function () {
                axios.post('/user/login', {
                    username: this.username,
                    password: this.password
                }).then(function (response) {
                    alert(response.data.token);
                    //存储在本地
                    localStorage.setItem("token", response.data.token);
                }).catch(function (error) {
                    console.log(error);
                });
            }
        },
        mounted: function () {
            this.loadData()
        }
    })
</script>
</body>
</html>