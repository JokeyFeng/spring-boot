<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户信息</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- 生产环境版本，优化了尺寸和速度 -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>

<div id="app">
    <table>
        <tr>
            <td>ID</td>
            <td>姓名</td>
            <td>年龄</td>
            <td>操作</td>
        </tr>
        <tbody>
        <tr v-for="(u) in user">
            <td>{{u.id}}</td>
            <td>{{u.name}}</td>
            <td>{{u.age}}</td>
            <!-- <td><a href="#" @onclick="update(u)">修改</a>|<a href="#" @onclick="remove(u.id)">删除</a></td>-->
            <td :class="'text-center'">
                <button @click="remove(u.id)">删除</button>
            </td>
        </tr>
        </tbody>
    </table>
    <div>
        姓名:<input v-model="name"><br>
        密码:<input v-model="pass"><br>
        年龄:<input v-model="age"><br>
        手机:<input v-model="mobile"><br>
        <button @click="save">提交</button>
    </div>

    <div>
        姓名:<input v-model="username"><br>
        密码:<input v-model="password"><br>
        <button @click="login">登录</button>
    </div>

    <div>
        <button @click="getData">查询</button>
    </div>
</div>

<script type="text/javascript">
    axios.defaults.baseURL = 'http://127.0.0.1:8890';
    // axios.defaults.headers.common['authorization'] = localStorage.getItem("token");

    // 添加请求拦截器
    axios.interceptors.request.use(function (config) {
        // 在发送请求之前做些什么
        console.log(config);
        if (config.method !== 'OPTIONS') {
            config.headers.Authorization = localStorage.getItem("token");
        }
        return config;
    }, function (error) {
        // 对请求错误做些什么
        return Promise.reject(error);
    });

    // 添加响应拦截器
    /*axios.interceptors.response.use(function (response) {
        // 对响应数据做点什么
        console.log(response);
        return response;
    }, function (error) {
        // 对响应错误做点什么
        return Promise.reject(error);
    });*/

    var app = new Vue({
        el: "#app",
        data: {
            user: [{"id": 1, "name": "zhengjingfeng", "age": 20}],
            name: "",
            age: 0,
            pass: "",
            mobile: "",
            username: "",
            password: ""
        },
        methods: {
            loadData: function () {
                // 为给定 ID 的 user 创建请求
                var that = this;
                axios.get('/user/list')
                    .then(function (response) {
                        that.user = response.data;
                    })
                    .catch(function (error) {
                        alert(error);
                        console.log(error);
                    });

            },
            getData: function () {
                // 为给定 ID 的 user 创建请求
                axios.get('/user/get')
                    .then(function (response) {
                        alert(response);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            },
            remove: function (id) {
                // 为给定 ID 的 user 创建请求
                if (!confirm('是否删除')) {
                    return;
                }
                axios.delete('/user/remove?id=' + id)
                    .then(function (response) {
                        alert(response);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            },
            save: function () {
                axios.post('/user/save', {
                    name: this.name,
                    pass: this.pass,
                    age: this.age,
                    mobile: this.mobile
                }).then(function (response) {
                    alert(response.data);
                }).catch(function (error) {
                    alert(error);
                    console.log(error);
                });
            },
            login: function () {
                axios.post('/user/login', {
                    username: this.username,
                    password: this.password
                }).then(function (response) {
                    alert(response.data.token);
                    //存储在本地
                    localStorage.setItem("token", response.data.token);
                }).catch(function (error) {
                    alert(error);
                    console.log(error);
                });
            }
        },
        mounted: function () {
            this.loadData()
        }
    })
</script>
</body>
</html>