<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户信息</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- 生产环境版本，优化了尺寸和速度 -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>

<div id="app">

    <fieldset>
        <legend>
            新增用户
        </legend>
        <div class="form-group">
            <label>姓名:</label>
            <input type="text" v-model="newUser.name"/>
        </div>
        <div class="form-group">
            <label>年龄:</label>
            <input type="text" v-model="newUser.age"/>
        </div>
        <div class="form-group">
            <label>密码:</label>
            <input type="text" v-model="newUser.pass"/>
        </div>
        <div class="form-group">
            <label>手机:</label>
            <input type="text" v-model="newUser.mobile"/>
        </div>
        <div class="form-group">
            <label>性别:</label>
            <select v-model="newUser.sex">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
        </div>
        <div class="form-group">
            <label></label>
            <button @click="save">保存</button>
        </div>
    </fieldset>

    <table>
        <thead>
        <tr>
            <td>ID</td>
            <td>姓名</td>
            <td>年龄</td>
            <td>操作</td>
        </tr>
        <thead>
        <tbody>
        <tr v-for="u in user">
            <td>{{u.id}}</td>
            <td>{{u.name}}</td>
            <td>{{u.age}}</td>
            <td :class="'text-center'" style="width:100px">
                <button @click="update(u)">修改</button>
                <button @click="remove(u.id)">删除</button>
            </td>
        </tr>
        </tbody>
    </table>

    <fieldset>
        <div class="form-group">
            <label>姓名:</label>
            <input type="text" v-model="loginUser.name"/>
        </div>
        <div class="form-group">
            <label>密码:</label>
            <input type="text" v-model="loginUser.pass"/>
        </div>
        <div class="form-group">
            <label></label>
            <button @click="login">登录</button>
        </div>
    </fieldset>

    <!--<div>
        ID:<input v-model="id">
        <button @click="getData(id)">查询</button>
    </div>-->
</div>

<script type="text/javascript">
    axios.defaults.baseURL = 'http://127.0.0.1:8890';

    // 添加请求拦截器
    axios.interceptors.request.use(function (config) {
        // 在发送请求之前做些什么
        console.log(config);
        if (config.method !== 'OPTIONS') {
            config.headers.Authorization = localStorage.getItem("token");
        }
        return config;
    }, function (error) {
        // 对请求错误做些什么
        return Promise.reject(error);
    });

    var app = new Vue({
        el: "#app",
        data: {
            user: [{"id": 1, "name": "zhengjingfeng", "age": 20}],
            newUser: {
                name: "",
                age: 0,
                pass: "",
                mobile: ""
            },
            loginUser: {
                name: "",
                pass: ""
            }
        },
        methods: {
            loadData: function () {
                // 为给定 ID 的 user 创建请求
                var that = this;
                axios.get('/user/list')
                    .then(function (response) {
                        that.user = response.data.data;
                    })
                    .catch(function (error) {
                        alert(error);
                        console.log(error);
                    });

            },
            getData: function (id) {
                // 为给定 ID 的 user 创建请求
                var that = this;
                axios.get('/user/get?id=' + id)
                    .then(function (response) {
                        that.user = response.data.data;
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            },
            remove: function (id) {
                // 为给定 ID 的 user 创建请求
                if (!confirm('是否删除')) {
                    return;
                }
                axios.delete('/user/remove?id=' + id)
                    .then(function (response) {
                        alert(response.data.data);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            },
            save: function () {
                if (!confirm('是否添加')) {
                    return;
                }
                axios.post('/user/save', {
                    name: this.newUser.name,
                    pass: this.newUser.pass,
                    age: this.newUser.age,
                    mobile: this.newUser.mobile
                }).then(function (response) {
                    alert(response.data.data);
                }).catch(function (error) {
                    alert(error);
                    console.log(error);
                });
            },
            update: function (u) {
                if (!confirm('是否修改')) {
                    return;
                }
                axios.put('/user/update', {
                    name: u.name,
                    pass: u.pass,
                    age: u.age,
                    mobile: u.mobile
                }).then(function (response) {
                    alert(response.data.data);
                }).catch(function (error) {
                    alert(error);
                });
            },
            login: function () {
                axios.post('/user/login', {
                    name: this.loginUser.name,
                    pass: this.loginUser.pass
                }).then(function (response) {
                    alert(response.data.token);
                    //存储在本地
                    localStorage.setItem("token", response.data.token);
                }).catch(function (error) {
                    alert(error);
                    //console.log(error);
                });
            }
        },
        mounted: function () {
            this.loadData()
        }
    })
</script>
</body>
</html>